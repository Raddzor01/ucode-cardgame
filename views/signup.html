<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Registration</title>
        <link href='https://fonts.googleapis.com/css?family=DotGothic16'
            rel='stylesheet'>
        <link href='https://fonts.googleapis.com/css?family=VT323'
            rel='stylesheet'>
        <link rel="stylesheet" href="/registration.css">
    </head>

    <body id="signup_body">
        <div class="message_error">
            Error
        </div>
        <div class="auth_container">

            <div class="wrapper">

            <p class="banner">Create an Acccount</p>
            <p class="desc">Sign up and start playing!</p>

            <form action="/signup" method="post" id="singupForm">

                <label for="username">username: </label>
                <input type="text" name="username" id="username"
                    placeholder="Please enter username" required>

                <label for="email">email: </label>
                <input type="email" name="email" id="email"
                    placeholder="Please enter email" required>

                <label for="password">password: </label>
                <input type="password" name="password" id="password"
                    placeholder="Please enter password" required minlength="4">

                <button type="submit" id="create_acc_btn">Create Account</button>
                <button type="button" id="sign_in_btn"
                    onclick="window.location.assign('/login')">Log in
                    </button>

            </form>
        </div>

        </div>

<script>
document.getElementById("singupForm").addEventListener("submit", function (event) {
    event.preventDefault();

    const username = document.querySelector('#username').value;
    const email = document.querySelector('#email').value;
    const password = document.querySelector('#password').value;

    if (username === '') {
        alert('Пожалуйста, введите логин.');
        return; // Останавливаем отправку формы
    }

    if (password === '') {
        alert('Пожалуйста, введите пароль.');
        return;
    }

    // Проверка на правильный формат email
    var emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
    if (!emailRegex.test(email)) {
        alert('Пожалуйста, введите корректный email.');
        return;
    }

    // Создаем объект с данными, которые будут отправлены на сервер
    const data = {
        name: username,
        email: email,
        password: password
    };

    // Отправляем данные на сервер с использованием AJAX-запроса
    fetch('/signup', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
        .then(response => {
            if (response.redirected) {
                document.location = response.url;
            } else {
                // Обработка ошибки от сервера
                // Вывести сообщение об ошибке или выполнить другие действия
                console.error('Ошибка при отправке данных на сервер.');
            }
        })
        .catch(error => {
            // Обработка ошибки, которая могла возникнуть при отправке запроса
            console.error('Произошла ошибка при отправке запроса: ' + error.message);
        });
});
</script>
</body>

</html>